extends manage_layout.pug

include ../includes/_modals.pug
include ../includes/_icons.pug
include ../includes/_forms.pug

mixin ageBtn(age, name)
    label.btn.btn-gender-d.lazy-tooltip(data-toggle='tooltip', title=__(ages[age]))
        input(type='radio', name=name, value=age, autocomplete='off')
        +ageIcon(age)

mixin genderBtn(gender, name)
    label.btn.lazy-tooltip(class=`btn-gender-${gender}`, data-toggle='tooltip', title=__(genders[gender]))
        input(type='radio', name=name, value=gender, autocomplete='off')
        +genderIcon(gender)

block content
    span.table-add.float-right.mb-3.mr-2
        a.text-success(href='#', data-toggle='modal', data-target='#addGuestModal')
            i.fas.fa-plus.fa-2x(aria-hidden='true')
    table.data-table.table.table-responsive-md#guestsTable(data-page-length='25',
                                                        data-age-column='1'
                                                        data-gender-column='2'
                                                        data-action-column='3'
                                                        data-delete-modal='#deleteGuestModal'
                                                        data-edit-modal='#editGuestModal'
                                                        data-edit-form='#editGuestForm'
                                                        data-group-column='4'
                                                        data-order='[[ 1, "asc" ]]',
                                                        data-ajax='/manage/guests/list',
                                                        data-columns='[{"data": "name"},{"data": "age"},{"data": "gender"},{"data": "_id"},{"data": "group"}]')
        thead
            tr
                th= __('Name')
                th= __('Age')
                th= __('Gender')
                th= __('Action')
                th Group

    +wideModal('addGuestModal',
                __('Add Guests'),
                __('Add'),
                __('Abort'),
                'addGuestForm',
                __('Error while transmitting data'))(class='clear-form')
        form.endlessInput.ajaxForm#addGuestForm(data-input-template='#inputTemplate',
                                                data-modal='#addGuestModal',
                                                data-error='#addGuestModalError',
                                                data-redraw-table='#guestsTable'
                                                method='post',
                                                action='/manage/guests')
            div.form-row
                div.form-group.col-6.mb-0
                    label(for='group')= __('Group')
                    input.form-control(type='text', name='group', placeholder=__('Group caption'))
                div.form-group.col-6.mb-0
                    label(for='address')= __('Address')
                    input.form-control(type='text', name='address', placeholder=__('Home address'))
            div.form-group
                hr
            div.form-row.collapse#inputTemplate
                div.form-group.col-sm-12.col-md-3.col-lg-6
                    input.form-control(type='text', name='guest%sname', placeholder=__('%s. Guest'))
                div.form-group.col-sm-6.col-md-6.col-lg-4
                    div.btn-group.btn-group-toggle(data-toggle='buttons')
                        each text, age in ages
                            if age !== 'undefined'
                                +ageBtn(age, 'guest%sage')

                div.form-group.col-sm-6.col-md-3.col-lg-2
                    div.btn-group.btn-group-toggle(data-toggle='buttons')
                        each text, gender in genders
                            if gender !== 'undefined'
                                +genderBtn(gender, 'guest%sgender')

    +deleteModal('deleteGuestModal',
                __('Remove Guest'),
                __('Error while sending request'),
                '/manage/guests/{id}',
                '#guestsTable')
        p= __('Remove this guest?')

    +modal('editGuestModal',
            __('Edit Guest'),
            __('Save'),
            __('Abort'),
            'editGuestForm',
            __('Error while transmitting data'))
        form.ajaxForm#editGuestForm(data-modal='#editGuestModal',
                                    data-error='#editGuestModalError',
                                    data-redraw-table='#guestsTable',
                                    data-fill-method='GET'
                                    method='PUT',
                                    action='/manage/guests/{id}')
            +editFormInput('name', __('Name'), __('Full Name'))
            +editFormInput('email', __('Email'), __('Email-Address'))
            +editFormInput('phone', __('Phone'), __('Phone Number'))
            +editFormInput('group', __('Group'), __('Group caption'))
            +editFormInput('address', __('Address'), __('Home address'))
            +editFormGroup('gender', __('Gender'))
                div.btn-group.btn-group-toggle(data-toggle='buttons')
                    each text, gender in genders
                        if gender !== 'undefined'
                            +genderBtn(gender, 'gender')
            +editFormGroup('age', __('Age'))
                div.btn-group.btn-group-toggle(data-toggle='buttons')
                    each text, age in ages
                        if age !== 'undefined'
                            +ageBtn(age, 'age')
            +editFormGroup('updatedAt', __('Last Change'))
                input.form-control-plaintext(type='text', readonly, name='updatedAt', data-format='datetime')